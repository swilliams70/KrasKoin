<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="refresh" content="30" />
    <title>Beacon Status Dashboard</title>
    <style>
      body {
        background-color: #0e0e0e;
        color: #f0f0f0;
        font-family: "Segoe UI", sans-serif;
        padding: 2rem;
      }

      h1 {
        color: #00ff99;
        text-shadow: 0 0 8px #00ff99;
        margin-bottom: 1rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: #1c1c1c;
        box-shadow: 0 0 10px rgba(0, 255, 153, 0.2);
      }

      th,
      td {
        padding: 0.75rem;
        text-align: left;
        border: 1px solid #333;
      }

      th {
        background-color: #00ff99;
        color: #000;
      }

      tr:nth-child(even) {
        background-color: #2a2a2a;
      }

      .footer {
        margin-top: 2rem;
        font-size: 0.9rem;
        color: #777;
      }

      button {
        margin-top: 1rem;
        background: #00ff99;
        color: #000;
        border: none;
        padding: 0.5em 1em;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background-color: #00cc77;
      }

      tr.selected {
        background-color: #00ff99 !important;
        color: #000;
      }
    </style>
    <script>
      let selectedRow = null;

      function selectRow(row) {
        if (selectedRow) selectedRow.classList.remove("selected");
        selectedRow = row;
        row.classList.add("selected");
      }

      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("del-row")
          ?.addEventListener("click", function () {
            if (!selectedRow) return alert("Select a row first.");
            const uuid = selectedRow.dataset.uuid;

            fetch(`/healthcheck/status/${uuid}/`, {
              method: "DELETE",
              headers: { "Content-Type": "application/json" },
            })
              .then((res) => res.json())
              .then((data) => {
                alert(data.status || "Deleted.");
                location.reload();
              })
              .catch((err) => {
                console.error(err);
                alert("Delete failed.");
              });
          });

        document
          .getElementById("update-row")
          ?.addEventListener("click", function () {
            if (!selectedRow) return alert("Select a row first.");
            const uuid = selectedRow.dataset.uuid;
            const h = prompt("Enter new heartbeat:");
            const j = prompt("Enter new jitter:");

            if (!h || !j) return;

            fetch(`/healthcheck/status/${uuid}/`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ uuid: uuid, h: h, j: j }),
            })
              .then((res) => res.json())
              .then((data) => {
                alert(data.status || data.error || "Updated.");
                location.reload();
              })
              .catch((err) => {
                console.error(err);
                alert("Update failed.");
              });
          });
      });
    </script>
  </head>
  <body>
    {% include '_navbar.html' %}
    <h1>üöÄ Beacon Status Dashboard</h1>

    <table>
      <thead>
        <tr>
          <th>IP</th>
          <th>UUID</th>
          <th>Heartbeat</th>
          <th>Jitter</th>
          <th>Last Check-In</th>
          <th>Next Check-In</th>
        </tr>
      </thead>
      <tbody>
        {% for beacon in beacons %}
        <tr onclick="selectRow(this)" data-uuid="{{ beacon.mid }}">
          <td>{{ beacon.ip }}</td>
          <td>{{ beacon.mid }}</td>
          <td>{{ beacon.heartbeat }}</td>
          <td>{{ beacon.jitter }}</td>
          <td>{{ beacon.lastCheckIn }}</td>
          <td>{{ beacon.nextCheckIn }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="table-controls">
      <button id="del-row">üóëÔ∏è Delete Beacon</button>
      <button id="update-row">‚úèÔ∏è Update Beacon</button>
    </div>

    <button onclick="location.reload()">üîÑ Refresh Now</button>
    <div class="footer">
      Auto-refreshes every 30 seconds. No JS libraries used.
    </div>
  </body>
</html>
